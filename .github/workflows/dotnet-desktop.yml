name: .NET CI

on:
  push:
    branches:
      - '**'
  pull_request:
    branches:
      - '**'

jobs:
  validate-commit-message:
    name: 🔎 Valider le message de commit
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Vérifier la présence d’un emoji spatial
        shell: bash
        run: |
          MSG="$(git log -1 --pretty=%B)"
          echo "Message de commit : $MSG"
          if ! echo "$MSG" | grep -qE '🚀|👽|🪐'; then
            echo "::error::Le message de commit doit contenir au moins un emoji spatial (🚀,👽,🪐)."
            exit 1
          fi

  build:
    name: 🏗️ Build & Test
    runs-on: windows-latest
    needs: validate-commit-message
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '7.0.x'

      - name: Cache NuGet packages
        uses: actions/cache@v3
        with:
          path: ~/.nuget/packages
          key: ${{ runner.os }}-nuget-${{ hashFiles('**/*.csproj', '**/*.fsproj') }}
          restore-keys: |
            ${{ runner.os }}-nuget-

      - name: Restore dependencies
        run: dotnet restore

      - name: Run tests
        run: dotnet test
